# 🏥 医学图像脂肪分析工具

> 一个简单易用的医学图像分析软件，专门用于计算图像中的脂肪含量

[![Python](https://img.shields.io/badge/Python-3.7+-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![OpenCV](https://img.shields.io/badge/OpenCV-4.12.0-orange.svg)](https://opencv.org/)

## 📖 这是什么？

这是一个专门用来分析医学图像中脂肪含量的软件。就像用Photoshop修图一样简单，但是专门用来测量图像中的脂肪比例。

**简单来说**：上传一张医学图像 → 在图像上画个圈圈 → 软件自动告诉你这个圈圈里有多少脂肪

## ✨ 主要功能

### 🎯 四种使用模式

| 模式 | 用途 | 适合人群 |
|------|------|----------|
| **交互式2D** | 单张图片分析 | 初学者、偶尔使用 |
| **交互式3D** | 3D医学图像分析 | 医生、研究人员 |
| **批量2D** | 一次性处理多张图片 | 需要大量分析 |
| **批量3D** | 一次性处理多个3D图像 | 专业研究 |

### 🖱️ 三种画图方式

- **矩形**：像画框一样，拖拽鼠标画个方框
- **圆形**：像画圆一样，点击圆心，拖拽画圆
- **多边形**：像画不规则图形，点击多个点连成任意形状

## 🚀 快速开始

### 第一步：安装软件

```bash
# 1. 下载代码
git clone https://github.com/lyh1999/ff-image-analyzer.git
cd ff-image-analyzer

# 2. 安装依赖（就像安装手机APP一样）
pip install -r requirements.txt

# 3. 运行软件
python main.py
```

### 第二步：选择模式

启动后会出现一个选择界面，就像选择游戏模式一样：

- **新手推荐**：选择"交互式2D模式"
- **3D图像**：选择"交互式3D模式" 
- **批量处理**：选择"批量2D模式"或"批量3D模式"

### 第三步：开始分析

1. **打开图片**：点击"打开图像"按钮
2. **画圈圈**：在图片上画出你想分析的区域
3. **保存结果**：按键盘上的 `S` 键保存
4. **查看结果**：圈圈上会显示脂肪含量数字

## 📱 使用教程

### 🖼️ 交互式2D模式（推荐新手）

**适用场景**：分析单张医学图像

**操作步骤**：
1. 点击"打开图像"选择一张图片
2. 选择画图工具（矩形/圆形/多边形）
3. 在图片上画出要分析的区域
4. 按 `S` 键保存，软件自动计算脂肪含量
5. 重复步骤3-4，可以画多个区域
6. 点击"保存"导出结果

**快捷键**：
- `S` - 保存当前画的区域
- `Ctrl+R` - 旋转图片90度
- `A/D` - 上一张/下一张图片
- `鼠标拖拽` - 画矩形
- `鼠标点击` - 画圆形或多边形

### 🧊 交互式3D模式

**适用场景**：分析3D医学图像（如CT、MRI扫描）

**操作步骤**：
1. 点击"打开图像"选择3D文件（.nii格式）
2. 选择查看方向（轴向/矢状/冠状）
3. 用鼠标滚轮切换不同的切片
4. 在切片上画区域并保存
5. 切换到其他切片继续分析
6. 最后保存所有结果

**快捷键**：
- `V` - 切换查看方向
- `鼠标滚轮` - 切换切片
- `A/D` - 上一张/下一张切片

### 📦 批量2D模式

**适用场景**：一次性分析很多张图片

**操作步骤**：
1. 准备两个文件夹：
   - 图片文件夹：放所有要分析的图片
   - 标签文件夹：放对应的区域标注图片
2. 在软件中选择这两个文件夹
3. 点击"开始处理"
4. 等待处理完成
5. 导出Excel结果表格

**文件命名要求**：
- 图片：`image1.png`
- 标签：`image1_roi.png` 或 `image1.png`

### 📦 批量3D模式

**适用场景**：批量处理多个3D医学图像

操作步骤与批量2D类似，但处理的是3D文件。

## 🎮 常用快捷键

### 通用快捷键
- `S` - 保存当前画的区域
- `Ctrl+R` - 旋转图片90度
- `Ctrl+S` - 保存整个项目
- `Ctrl+O` - 打开文件
- `Escape` - 取消当前操作
- `A/D` - 上一张/下一张

### 3D模式专用
- `V` - 切换查看方向
- `鼠标滚轮` - 切换切片

### 批量模式专用
- `空格` - 开始/停止批量处理
- `Ctrl+E` - 导出结果

## 📁 支持的文件格式

### 图片格式
- **2D图片**：PNG, JPG, BMP, TIFF
- **3D图片**：NIfTI (.nii, .nii.gz)

### 输出格式
- **图片**：PNG（带标注的图片）
- **数据**：JSON（详细数据）+ Excel（汇总表格）

## 💡 使用技巧

### 画图技巧
1. **矩形**：按住鼠标左键拖拽，就像在画图软件里画矩形一样
2. **圆形**：先点击确定圆心，再拖拽确定大小
3. **多边形**：连续点击多个点，最后点击起始点闭合

### 图片处理技巧
1. **旋转图片**：如果图片方向不对，用 `Ctrl+R` 旋转
2. **放大缩小**：鼠标滚轮可以缩放图片
3. **移动图片**：拖拽图片可以移动位置

### 批量处理技巧
1. **文件命名**：保持图片和标签文件名对应
2. **文件夹结构**：建议用英文命名文件夹
3. **处理顺序**：软件会按文件名顺序处理

## 🔧 安装要求

### 系统要求
- **操作系统**：Windows 10+, macOS 10.14+, Linux
- **Python版本**：3.7 或更高版本
- **内存**：建议 4GB 以上
- **硬盘**：至少 1GB 可用空间

### 依赖库
软件需要以下Python库（安装时自动处理）：
- OpenCV - 图像处理
- NumPy - 数学计算
- Pillow - 图片格式转换
- Nibabel - 3D医学图像处理
- Matplotlib - 数据可视化
- Pandas - 数据处理

## 📊 输出结果说明

### 交互式模式输出
- **图片文件**：`原文件名_with_roi.png`（带标注的图片）
- **数据文件**：`原文件名_roi_data.json`（详细分析数据）

### 批量模式输出
- **Excel表格**：`batch_analysis_results.xlsx`（所有结果的汇总）
- **CSV文件**：`batch_analysis_results.csv`（Excel的备选格式）

### 数据内容
每个分析区域会显示：
- 脂肪含量百分比
- 像素数量
- 平均值、标准差
- 最小值、最大值

## ❓ 常见问题

### Q: 软件打不开怎么办？
A: 检查Python版本是否为3.7+，确保所有依赖库已正确安装。

### Q: 图片显示不正常？
A: 尝试用 `Ctrl+R` 旋转图片，或者检查图片格式是否支持。

### Q: 批量处理很慢？
A: 3D图像处理需要更多时间，这是正常现象。可以先用少量图片测试。

### Q: 结果不准确？
A: 确保画的区域准确，避免包含不相关的区域。

### Q: 如何保存结果？
A: 交互式模式按 `Ctrl+S`，批量模式点击"导出结果"按钮。

## 🛠️ 技术信息

- **开发语言**：Python 3.12
- **界面框架**：Tkinter
- **图像处理**：OpenCV
- **3D图像**：Nibabel
- **数据可视化**：Matplotlib

## 📄 许可证

本项目仅供学习和研究使用。

## 📞 联系我们

如果您在使用过程中遇到问题，或者有改进建议，欢迎联系我们！

---

**让医学图像分析变得简单！** 🎉