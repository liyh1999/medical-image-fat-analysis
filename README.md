# 脂肪分数分析软件 v2.1

Fat Fraction Analysis Software v2.1

## 项目简介

这是一个专业的医学图像脂肪分数分析软件，支持2D和3D图像的交互式和批量处理模式。软件可以加载医学图像，绘制感兴趣区域(ROI)，并计算脂肪分数值。

## 主要功能

### 交互式模式
- **2D交互模式**：支持单张2D图像的分析
- **3D交互模式**：支持3D医学图像（NIfTI格式）的切片分析

### 批量处理模式
- **2D批量模式**：批量处理多张2D图像
- **3D批量模式**：批量处理多个3D医学图像

### ROI绘制功能
- **矩形ROI**：支持矩形区域绘制
- **圆形ROI**：支持圆形区域绘制
- **多边形ROI**：支持自由多边形区域绘制

### 图像处理功能
- **图像旋转**：支持90°、180°、270°旋转
- **坐标转换**：自动处理旋转后的坐标转换
- **图像缩放**：自适应窗口大小

## 项目结构

```
脂肪分数分析软件/
├── main.py                 # 主程序入口
├── requirements.txt        # 依赖库列表
├── README.md              # 项目说明文档
├── .gitignore             # Git忽略文件
└── src/                   # 源代码目录
    ├── main.py            # 程序主逻辑
    ├── gui_main.py        # 主界面控制器
    ├── gui_base.py        # GUI基类
    ├── gui_interactive_2d.py  # 2D交互模式界面
    ├── gui_interactive_3d.py  # 3D交互模式界面
    ├── gui_batch_2d.py    # 2D批量模式界面
    ├── gui_batch_3d.py    # 3D批量模式界面
    ├── analyzer.py        # 脂肪分数分析器
    ├── nifti_viewer.py    # 3D图像查看器
    └── utils.py           # 工具函数
```

## 安装说明

### 环境要求
- Python 3.7+
- Windows 10+ / macOS 10.14+ / Linux

### 安装步骤

1. **克隆或下载项目**
   ```bash
   git clone <项目地址>
   cd 脂肪分数分析软件
   ```

2. **创建虚拟环境（推荐）**
   ```bash
   conda create -n ff_analyzer python=3.12
   conda activate ff_analyzer
   ```

3. **安装依赖库**
   ```bash
   pip install -r requirements.txt
   ```

4. **运行程序**
   ```bash
   python main.py
   ```

## 依赖库

- **opencv-python==4.12.0.88** - 图像处理
- **numpy==1.26.4** - 数组操作
- **Pillow==11.3.0** - 图像格式转换
- **nibabel==5.3.2** - 3D医学图像处理
- **matplotlib==3.10.3** - 数据可视化
- **pandas==2.3.1** - 数据处理
- **scipy==1.15.3** - 科学计算

## 使用说明

### 启动软件
运行 `python main.py` 启动软件，选择相应的模式：
- 交互式2D：单张图像分析
- 交互式3D：3D医学图像分析
- 批量2D：批量处理2D图像
- 批量3D：批量处理3D图像

### 基本操作
1. **加载图像**：点击"打开图像"按钮选择图像文件
2. **绘制ROI**：选择ROI类型（矩形/圆形/多边形），在图像上绘制
3. **保存ROI**：按S键保存当前ROI
4. **计算脂肪分数**：ROI保存后自动计算并显示结果
5. **导出结果**：点击"导出结果"保存分析数据

### 快捷键
- **S键**：保存当前ROI
- **X键**：3D模式下切换切片
- **Ctrl+R**：旋转图像90°
- **鼠标滚轮**：3D模式下切换切片

## 支持的文件格式

- **2D图像**：BMP, JPG, PNG, TIFF等常见格式
- **3D图像**：NIfTI (.nii, .nii.gz) 格式

## 技术特点

- **模块化设计**：清晰的代码结构，易于维护和扩展
- **面向对象**：使用继承和多态，代码复用性高
- **错误处理**：完善的异常处理和日志记录
- **内存管理**：3D图像缓存机制，优化内存使用
- **坐标系统**：精确的坐标转换，支持图像旋转

## 开发信息

- **版本**：v2.1
- **开发语言**：Python 3.12
- **GUI框架**：Tkinter
- **图像处理**：OpenCV
- **版本控制**：Git

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请联系开发团队。
